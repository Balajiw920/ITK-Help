<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ITK Function Reference: pom/pom/pom_user_authentication.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<center>
     <img src=logo.jpg>
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ITK Function Reference<br><hr size="1">
    <font size="3">(V10000.1.0.60_20160308.00)</font></div>
  </td>
 </tr>
 </tbody>
</table>
</center>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4eefd79c1e0ec95ed361d0bce908c647.html">pom</a></li><li class="navelem"><a class="el" href="dir_bd25b89f168b0d7661e0ab6fb87c37e0.html">pom</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pom_user_authentication.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;pom/pom/libpom_exports.h&gt;</code><br/>
<code>#include &lt;pom/pom/libpom_undef.h&gt;</code><br/>
</div>
<p><a href="pom__user__authentication_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga878215a679f3e6154f2948aff8891572"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga878215a679f3e6154f2948aff8891572">POM_user_authentication_fn_t</a> )(const char *user, const char *password, const char *key)</td></tr>
<tr class="separator:ga878215a679f3e6154f2948aff8891572"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3009479d009c0d3e8ccb938d5428c216"><td class="memItemLeft" align="right" valign="top">POMAPI void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga3009479d009c0d3e8ccb938d5428c216">POM_ask_user_authentication_data</a> (void)</td></tr>
<tr class="separator:ga3009479d009c0d3e8ccb938d5428c216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaee2e1ff353f95fabef07090fb0600bed"><td class="memItemLeft" align="right" valign="top">POMAPI <a class="el" href="unidefs_8h.html#aeb66a8750140edf46869ed94e51b8007">logical</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gaee2e1ff353f95fabef07090fb0600bed">POM_has_user_authentication_fn</a> (void)</td></tr>
<tr class="separator:gaee2e1ff353f95fabef07090fb0600bed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb172ede1a86944f5afd4be1088a4598"><td class="memItemLeft" align="right" valign="top">POMAPI void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gafb172ede1a86944f5afd4be1088a4598">POM_set_user_authentication_fn</a> (<a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga878215a679f3e6154f2948aff8891572">POM_user_authentication_fn_t</a> user_exit, void *user_data)</td></tr>
<tr class="separator:gafb172ede1a86944f5afd4be1088a4598"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1aa549b00121947ffe9d7546c7e3b6a"><td class="memItemLeft" align="right" valign="top">POMAPI int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gac1aa549b00121947ffe9d7546c7e3b6a">POM_user_auth_ask_error</a> (void)</td></tr>
<tr class="separator:gac1aa549b00121947ffe9d7546c7e3b6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga653c5a84ec4b84b4c4878f8fccb4dd18"><td class="memItemLeft" align="right" valign="top">POMAPI <a class="el" href="unidefs_8h.html#aeb66a8750140edf46869ed94e51b8007">logical</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga653c5a84ec4b84b4c4878f8fccb4dd18">POM_user_auth_default_checker</a> (const char *user, const char *password)</td></tr>
<tr class="separator:ga653c5a84ec4b84b4c4878f8fccb4dd18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga442103d833e139f1a77f00b9c0f4d6db"><td class="memItemLeft" align="right" valign="top">POMAPI void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga442103d833e139f1a77f00b9c0f4d6db">POM_user_auth_set_error</a> (int error)</td></tr>
<tr class="separator:ga442103d833e139f1a77f00b9c0f4d6db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga297fa97aa2c89e249ecf6b0a11c21573"><td class="memItemLeft" align="right" valign="top">POMAPI void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga297fa97aa2c89e249ecf6b0a11c21573">POM_user_authentication_cb</a> (const char *secret, <a class="el" href="unidefs_8h.html#aeb66a8750140edf46869ed94e51b8007">logical</a> status)</td></tr>
<tr class="separator:ga297fa97aa2c89e249ecf6b0a11c21573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae1b94dd775d5b0b1e9cf906b2c59889a"><td class="memItemLeft" align="right" valign="top">POMAPI <a class="el" href="unidefs_8h.html#aeb66a8750140edf46869ed94e51b8007">logical</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gae1b94dd775d5b0b1e9cf906b2c59889a">POM_user_authentication_invoke</a> (const char *user, const char *password)</td></tr>
<tr class="separator:gae1b94dd775d5b0b1e9cf906b2c59889a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Support for integrating with external user authentication. e.g. LDAP.</p>
<p>The existing Teamcenter Engineering clients and servers expect to be given a user id and password. The authentication of which is performed within the POM login code. The POM's default login code can now be replaced via a user exit. However there are several issues the exit must cope with to balance the requirement to be replaced while still be secure given ITK and split client/server authentication schemes.</p>
<p>Requirements: </p>
<ol>
<li>
Allow the POM authentication of user id/password to be replaced - requires an exit. </li>
<li>
Ensure that exit can be validated - avoid the obvious replacement with an implementation that simply returns true (ignoring the password). i.e. prevent subversion of security by ensuring the code is trustworthy. </li>
<li>
Allow the client side to perform the authentication. Since it has the UIF and many authentication devices operate at the client side, we should allow the client to assert the user as authenticated. This means we wont have a password for the user. However a password should still be required inorder that we trust the source of the user id. In the case of the server side exit expecting the client to assert a user then in the absence of a password of some sort being given to the server an alternative client could call the server without actually having performed the authentication. </li>
</ol>
<p>The exit is given the user, their password as entered, and a "key" for validating the algorithim is approved by the admin. The key has a corresponding "secret" that is derived from the key in a manner known only to the exits implementor. The key and secret are made known to the POM via an install option:</p>
<p>$TC_BIN/install -set_eim_key &lt;dba user&gt; &lt;dba pass&gt; &lt;dba group&gt; login &lt;key&gt; &lt;secret&gt;</p>
<dl class="section note"><dt>Note</dt><dd>The secret is stored one-way encrypted in the DB - so sql access should not allow it to be compromised.</dd></dl>
<p>Once a key/secret pair is established then the implementor can register their exit using POM_set_user_authentication_fn from the user exit <a class="el" href="group___u_s_e_r___e_x_i_t_s.html#ga431d5ac16f6c593fe8c861e85380d3b2">USER_preinit_module</a>. The key will be looked up inorder to call the exit with the necessary info.</p>
<p>The exit informs the POM of whether the password is correct via a callback. The callback also expects to be told what the keys corresponding secret was. If this compares against the DB record then the exit is trusted and its verdict on the validity of the password is accepted.</p>
<p>This is done as a callback in preference to simple return arguments so as to avoid attempts to replace the user exit with a wrapper that calls the genuine implementation, and thus can intecept the correct secret, but changes the verdict on the password is avoided.</p>
<p>When the users password is fully authenticated at the client then the password sent to the server should be used to ensure the client is trusted. Whatever password is sent should be derived in a secure manner from the user id. So, for the Web client, if I observe the http requests of my own authenticated session then I could only use that info to access the server directly (bypassing the Web client and authentication code) for my own account - which is obviously already checked and so not revealing anything not already available. However such observation of the password sent should not allow a socket level accessor to guess the password for other users accounts (either due it being hardwired or trivially derived).</p>
<p>Thus: for a secure login with external authentication (client side) the system should be secure against attempts to replace the exit (server side) and/or present a client that asserts it's authentic without having used the required tests.</p>
<dl class="section note"><dt>Note</dt><dd>If the exit requires some context (such as certificates, connection info, etc) then the closure arg can be passed in when setting the exit and requested from within the exit via <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga3009479d009c0d3e8ccb938d5428c216">POM_ask_user_authentication_data</a>.</dd>
<dd>
This scheme does still require that the user identified does exist in the Teamcenter Engineering DB. It is simply the Teamcenter Engineering password that is unused.</dd>
<dd>
<a class="el" href="group___p_o_m.html#gad738dc385848570a97b3377c68f8a5a4">POM_check_password</a> will also use the exit to authenticate. But the <a class="el" href="group___p_o_m.html#ga80f726bb95f4382ec17754ef5f9a36dd">POM_set_password</a> function will return <a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga16891950ef3f7c0fd631020f622b2b41">POM_op_not_supported</a>. We don't have any basis for communicating a password change to an authentication server.</dd></dl>
<p>Typical usage: </p>
<ol>
<li>
<p class="startli">Establish a key/secret pair.</p>
<p>$TC_BIN/install -set_eim_key infodba &lt;dba-pass&gt; dba login key secret</p>
<p class="endli"></p>
</li>
<li>
Prior to POM login ( <a class="el" href="group___p_o_m.html#gaafef11a5fe5c667d29769d330bad23bf">POM_login</a> / <a class="el" href="group___p_o_m.html#ga145ccc05ff757746a79692bfc90ec7b7">POM_start</a> ) register your own password authentication function via POM_set_user_authentication_fn. Do this from <a class="el" href="group___u_s_e_r___e_x_i_t_s.html#ga431d5ac16f6c593fe8c861e85380d3b2">USER_preinit_module</a> - which gets called before login.<dl class="section note"><dt>Note</dt><dd><a class="el" href="group___u_s_e_r___e_x_i_t_s.html#ga16ae2531ab9f348d624102852af69b6c">USER_init_module</a> gets called after login, and thus does not satisfy the requirements.</dd></dl>
</li>
<li>
Within that exit derive the secret from the key and determine the validity of your password against the given user. Callback to the POM code with the secret and status (true if the password was good) via <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga297fa97aa2c89e249ecf6b0a11c21573">POM_user_authentication_cb</a>. </li>
</ol>
<p>Error messages given to the user:</p>
<p>By default the error codes you may get from POM_start/login/etc are (in order raised):</p>
<p><a class="el" href="group___p_o_m___e_r_r_o_r_s.html#gaee23ddef04ab31050692d0bd89ab141d">POM_no_exit_key_set</a> - Couldn't find the "login" key. Inorder to validate the exit a "key" must be set via "install -set_eim_key".</p>
<p><a class="el" href="group___p_o_m___e_r_r_o_r_s.html#gab3a8f84bdf4f2053b6bff1b9d7349d77">POM_bad_pass_exit</a> - The exit called back with a "secret" that did not match the "login" secret. Suggests exit not trustworthy.</p>
<p><a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga5037bf41fbf0a3c6cfdf2fe2e227e017">POM_pass_exit_failure</a> - This is a catch all - if the exit code raises an error of some sort it is caught. Check syslog for what may have failed.</p>
<p><a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga0354a32cde9e2fb092f905eec2877a40">POM_invalid_account_values</a> - The exit succeeded and is trusted, but it claims the user id and or password is false. This is the same error a POM login with no exit would raise when the password is not correct.</p>
<p>If an error code other than <a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga0354a32cde9e2fb092f905eec2877a40">POM_invalid_account_values</a> is required then it can be set via <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga442103d833e139f1a77f00b9c0f4d6db">POM_user_auth_set_error</a>. The POM_start/POM_login/etc will still return <a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga0354a32cde9e2fb092f905eec2877a40">POM_invalid_account_values</a> , but <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gac1aa549b00121947ffe9d7546c7e3b6a">POM_user_auth_ask_error</a> can be used to see that the customization has set a more specific error.</p>
<p>For Teamcenter Engineering login, if the POM returns <a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga0354a32cde9e2fb092f905eec2877a40">POM_invalid_account_values</a>, and we get a non-zero return from <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gac1aa549b00121947ffe9d7546c7e3b6a">POM_user_auth_ask_error</a>, then the Teamcenter Engineering error stack is left alone - as it is assumed the user has already posted relevant info (via the EHM functions - see ehm.h). If <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#gac1aa549b00121947ffe9d7546c7e3b6a">POM_user_auth_ask_error</a> does return zero (no error set) then the <a class="el" href="group___p_o_m___e_r_r_o_r_s.html#ga0354a32cde9e2fb092f905eec2877a40">POM_invalid_account_values</a> error will be posted (as usual). The higher precedence error codes cannot be overridden in this manner - since they imply the exit was bad, not just failing.</p>
<p>By allowing the exit to post errors directly to the Teamcenter Engineering error stack more info can be supplied to the user than the POM error code would allow. The errors should at least differentiate failure to check the password from a test that worked, but found the password to be wrong. e.g. supply substituted values - such as a server name if there was a problem contacting the external authentication service. Or "number of tries left" if the exit enforces a limited number of attempts on login.</p>
<p>Further notes. </p>
<ul>
<li>
<p class="startli">Using Teamcenter Engineering password checking from the exit.</p>
<p>If a combination of external and internal authentication is required (e.g. infodba requires Teamcenter Engineering password, but regular users use a common external account) then the existing Teamcenter Engineering password checker can be called via: <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga653c5a84ec4b84b4c4878f8fccb4dd18">POM_user_auth_default_checker</a>. e.g. </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> auth_test_fn(<span class="keywordtype">char</span>* user, <span class="keywordtype">char</span>* password, <span class="keywordtype">char</span>* key)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="unidefs_8h.html#aeb66a8750140edf46869ed94e51b8007">logical</a> status = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(user, <span class="stringliteral">&quot;infodba&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        status = <a class="code" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga653c5a84ec4b84b4c4878f8fccb4dd18">POM_user_auth_default_checker</a>(user, password);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> err = 0;</div>
<div class="line">        <span class="keywordtype">char</span>* server = my_ext_auth_server();</div>
<div class="line">        err = my_check_password(server, user, password, &amp;status);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (err != 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="group___e_m_h.html#gafd7d6f9c18b8f304b61b73dccbf80b33">EMH_store_initial_error_s1</a>(<a class="code" href="emh_8h.html#a4d9d1c2260daf5cccd75cecf88bca0c3">EMH_severity_error</a>, USER_ERROR_CODE, server_name);</div>
<div class="line">            <a class="code" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga442103d833e139f1a77f00b9c0f4d6db">POM_user_auth_set_error</a>(USER_ERROR_CODE);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga297fa97aa2c89e249ecf6b0a11c21573">POM_user_authentication_cb</a>(my_key_to_secret(key), status);</div>
<div class="line">}</div>
</div><!-- fragment --><p> The "my_ext_auth_server", "my_check_password" and "my_key_to_secret" are a fictional example of what you might have to call outside of iMAN... Note the need to demonstrate exit is good - even if just delegating back to Teamcenter Engineering check.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Access to other objects within exit.</p>
<p>Most POM functions require the user to be logged in before they can be called. A small subset can be used. Notably, you cannot load POM objects (requires access checks). But you can use POM queries. This may pose a problem for storing information gathered during login - e.g. marking user as disabled after some number of failed attempts to login.</p>
<p>As a side note to developers - making load/edit/save available with bypass wouldn't help since the login will rollback on getting an error. Today if I were to need to store "additional attributes" against a user I'd create a seperate table (since we don't support adding attributes to core objects, like user) and accessing it via the POM procedure functions - therein an autonomous transaction can ensure that any updates are not rolled back on raising an error.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="group___p_o_m.html#gad738dc385848570a97b3377c68f8a5a4">POM_check_password</a> vs. <a class="el" href="group___p_o_m.html#ga145ccc05ff757746a79692bfc90ec7b7">POM_start</a> / <a class="el" href="group___p_o_m.html#gaafef11a5fe5c667d29769d330bad23bf">POM_login</a>.</p>
<p>Compare will only test for whether the password is right or wrong. If an error has been set (via <a class="el" href="group___p_o_m___u_s_e_r___a_u_t_h_e_n_t_i_c_a_t_i_o_n.html#ga442103d833e139f1a77f00b9c0f4d6db">POM_user_auth_set_error</a>) then it is raised. If no error is set (the default) then the compare function will just return the status given. Therefore if no error is set then you should return false, but the caller will not be able to differentiate "check failed" (e.g. external server down) from "checked ok, and the password is wrong".</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">User id lowercasing and i18n issues.</p>
<p class="endli">The user id and password are both passed into the authentication exit raw (as supplied to POM login). The user id's are stored in lower case in the DB - thus user id's returned once logged in may differ from what the user supplied the exit. This may matter when contacting external services. If a query is needed to lookup the user tag (hence UID) then the case insensitive flag should be used. Internally the case mapping uses the TEXT functions so as to be sensitive to locale. Passwords have case preserved. </p>
</li>
</ul>

<p>Definition in file <a class="el" href="pom__user__authentication_8h_source.html">pom_user_authentication.h</a>.</p>
</div></div><!-- contents -->
<!-- HTML footer for Doxygen 1.8.3.1-->
<!-- start footer part -->
<hr class="footer"/>
        <hr size="1">
        <center>
            <img src=logo.jpg>
        </center>
</body>
</html>
